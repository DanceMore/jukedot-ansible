#!/bin/bash

DISPLAY="{{ xvfb_display }}"
export XDG_RUNTIME_DIR="/run/user/$(id -u {{ easyeffects_user }})"
STATE_FILE="$XDG_RUNTIME_DIR/bass-trim.state"

case "$1" in
  on|enable|cut)
    echo "Enabling bass cut..."
    easyeffects --load-preset bass-trim
    echo "on" > "$STATE_FILE"
    ;;
  off|disable|normal)
    echo "Disabling bass cut (normal audio)..."
    easyeffects --reset
    echo "off" > "$STATE_FILE"
    ;;
  toggle)
    if [[ -f "$STATE_FILE" && "$(cat "$STATE_FILE")" == "on" ]]; then
      echo "Bass cut is ON, turning OFF..."
      easyeffects --reset
      echo "off" > "$STATE_FILE"
    else
      echo "Bass cut is OFF, turning ON..."
      easyeffects --load-preset bass-trim
      echo "on" > "$STATE_FILE"
    fi
    ;;
  status)
    if [[ -f "$STATE_FILE" && "$(cat "$STATE_FILE")" == "on" ]]; then
      echo "Bass cut: ENABLED"
    else
      echo "Bass cut: DISABLED"
    fi
    ;;
  *)
    echo "Usage: $0 {on|off|toggle|status}"
    echo "  on/enable/cut       - Enable bass cut"
    echo "  off/disable/normal  - Disable bass cut" 
    echo "  toggle               - Switch between on/off"
    echo "  status               - Show current state"
    exit 1
    ;;
esac
